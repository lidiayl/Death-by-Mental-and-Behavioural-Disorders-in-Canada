<!DOCTYPE html>
<link rel="stylesheet" href="styles.css">
<html>
<head>
    <title>Death by Mental and Behavioural Disorders in Canada</title>
</head>

<svg width='960' height='500'></svg>

<script src='https://d3js.org/d3.v6.min.js'></script>

<style>
  .chart rect { fill: steelblue; }
  #tooltip {
      opacity: 0;
      position: absolute;
      text-align: center;
      width: 120px; height: 60px;
      background: #ccf3ff;
      border: 0.5px;
      font-family: sans-serif;
      font-size: small;
  }
  </style>

<body>
<div id="tooltip"></div>
<script>
    const svg = d3.select('svg');
    const width = 960;
    const height = 500;

    const numberFormat = d3.format(',.0f');

    var tooltip = d3.select('#tooltip');

    const render = data => {
        const xValue = d => d.Year;
        const yValue = d => d.Total;
        const margin = {top:50, right:50, bottom:50, left:100};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const xScale = d3.scaleBand()
            .domain(data.map(xValue))
            .range([0,innerWidth])
            .padding(0,3);
        
        const yScale = d3.scaleLinear()
            .domain([d3.max(data,yValue),0])
            .range([0,innerHeight]);

        const g = svg.append('g')
          .attr('transform',`translate(${margin.left},${margin.top})`);

        const xAxis = g.append('g')
          .call(d3.axisBottom(xScale))
          .attr('transform',`translate(0,${innerHeight})`)
          g.append('text')
            .attr('x', innerWidth/2)
            .attr('y',450)
            .attr('fill', 'darkblue')
            .attr('font-family','sans-serif')
            .text('Year');

        const yAxisTickFormat = number => 
          format('.2s')(number);

        const yAxis = g.append('g')
            .call(d3.axisLeft(yScale))
            g.append('text')
              .attr('x',-50)
              .attr('y', -20)
              .attr('fill','darkblue')
              .attr('font-family','sans-serif')
              .text('Deaths')

        g.selectAll('rect')
          .data(data)
          .enter()
          .append('rect')
            .attr('x', d => xScale(xValue(d)))
            .attr('y', d => yScale(yValue(d)))
            .attr('width', 30)
            .attr('height',d => innerHeight - yScale(yValue(d)))
            .attr('fill','#4d88ff')
          .on("mouseover", function(d,i) {
            d3.select(this)
              .attr('fill','maroon');
            tooltip.style('opacity', 1)
              .style('left',(d.pageX)+'px')
              .style('top',(d.pageY)+'px')
              .html("<p><span class='toolTip'>" + "Year: " + xValue(i) + "</span><br>" + "Deaths: " +numberFormat(yValue(i)) + "</p>")
          })
          .on('mousemove', function(d) {
            tooltip
              .style('top',(d3.pageX-5)+'px')
              .style('left',(d3.pageY+10)+'px');
          })
          .on('mouseout', function() { 
            d3.select(this)
              .transition()
              .duration(250)
              .attr('fill','#4d88ff');
            tooltip.style('opacity', 0) 
          })
    }

    d3.csv('scene01_data.csv').then(data => {
        data.forEach(d=> {
            d.Total=+d.Total;
        });
        render(data);
    });

</script>
</body>
</html>