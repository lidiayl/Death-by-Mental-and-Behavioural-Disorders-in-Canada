<!DOCTYPE html>
<link rel="stylesheet" href="styles.css">
<html>
<head>
    <title>Death by Mental and Behavioural Disorders in Canada</title>
</head>

<script src='https://d3js.org/d3.v6.min.js'></script>

<body>
  <h1>Death by Mental and Behavioural Disorders in Canada</h1>
  <br>
  <a href="index.html"><img src="back.png" alt="back" style="width:50px;height:25px;"></a>
  <a href="scene03.html"><img src="next.png" alt="next" style="width:50px;height:25px;"></a>
  <br>
<svg width='960' height='500'></svg>
<div id="tooltip"></div>
<div id="myAnnotation"></div>
<script>
    const svg = d3.select('svg');
    const width = 960;
    const height = 500;

    const numberFormat = d3.format(',.0f');

    var tooltip = d3.select('#tooltip');
    var myAnnotation = d3.select('#myAnnotation')
          .transition()
          .delay(100);

    const render = data => {
        const xValue = d => d.Age;
        const yValue = d => d.Total;
        const margin = {top:50, right:50, bottom:50, left:100};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const xScale = d3.scaleBand()
            .domain(data.map(xValue))
            .range([0,innerWidth])
            .padding(0,3);
        
        const yScale = d3.scaleLinear()
            .domain([d3.max(data,yValue),0])
            .range([0,innerHeight]);

        const g = svg.append('g')
          .attr('transform',`translate(${margin.left},${margin.top})`);

        const xAxis = g.append('g')
          .call(d3.axisBottom(xScale))
          .attr('transform',`translate(0,${innerHeight})`)
          g.append('text')
            .attr('x', innerWidth/2)
            .attr('y',440)
            .attr('fill', 'darkblue')
            .attr('font-family','sans-serif')
            .text('Age');

        const yAxisTickFormat = number => 
          format('.2s')(number);

        const yAxis = g.append('g')
            .call(d3.axisLeft(yScale))
            g.append('text')
              .attr('x',-50)
              .attr('y', -20)
              .attr('fill','darkblue')
              .attr('font-family','sans-serif')
              .text('Deaths')

        g.selectAll('rect')
          .data(data)
          .enter()
          .append('rect')
            .attr('x', d => xScale(xValue(d)))
            .attr('y', d => yScale(yValue(d)))
            .attr('width', 30)
            .attr('height',d => innerHeight - yScale(yValue(d)))
            .attr('fill','steelblue')
          .on("mouseover", function(d,i) {
            d3.select(this)
              .attr('fill','maroon');
            tooltip.style('opacity', 1)
              .style('left',(d.pageX)+'px')
              .style('top',(d.pageY)+'px')
              .html("<p><span class='toolTip'>" + "Age: " + xValue(i) + "</span><br>" + "Deaths: " +numberFormat(yValue(i)) + "</p>")
          })
          .on('mousemove', function(d) {
            tooltip
              .style('top',(d3.pageX-5)+'px')
              .style('left',(d3.pageY+10)+'px');
          })
          .on('mouseout', function() { 
            d3.select(this)
              .transition()
              .duration(250)
              .attr('fill','steelblue');
            tooltip.style('opacity', 0) 
          })

  // Draw annotation
  var theAnnotations = [1,2];

  var annotations = svg.selectAll('.annotations')
    .data(theAnnotations)
    .enter().append('g')
    .attr('class','myAnnotation')
    .attr('transform',function(d, i) { return 'translate(50,' + i * 30 + ')'; });

  annotations.append('text')
    .attr('x', 100)
    .attr('y', 50)
    .transition()
    .delay(1000)
    .text(function(d, i) { 
      switch (i) {
        case 0: return ('- the highest deaths occured in seniors over 70 years old')
        case 1: return ('- young people tend to be more resistant and to be able survive')
      }
    });
          
    } 

    d3.csv('scene02_data.csv').then(data => {
        data.forEach(d=> {
            d.Total=+d.Total;
        });
        render(data);
    });

</script>
</body>
</html>